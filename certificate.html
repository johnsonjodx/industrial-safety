<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate of Completion - Industrial Safety</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .certificate {
            background: white;
            padding: 0;
            border-radius: 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 210mm;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        .certificate-border {
            border: 20px solid gold;
            padding: 40px;
            background: white;
        }

        .certificate-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .certificate-logo {
            font-size: 5em;
            color: #764ba2;
            margin-bottom: 20px;
        }

        .certificate-title {
            font-size: 3em;
            color: #764ba2;
            font-weight: bold;
            letter-spacing: 3px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .certificate-subtitle {
            font-size: 1.5em;
            color: #666;
            border-top: 2px solid gold;
            border-bottom: 2px solid gold;
            padding: 15px;
            display: inline-block;
        }

        .certificate-body {
            text-align: center;
            margin: 50px 0;
        }

        .certificate-label {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 15px;
        }

        .certificate-name {
            font-size: 3.5em;
            font-weight: bold;
            color: #333;
            margin: 30px 0;
            padding: 25px;
            border-bottom: 3px dashed gold;
            border-top: 3px dashed gold;
            font-family: 'Times New Roman', serif;
        }

        .certificate-text {
            font-size: 1.3em;
            color: #555;
            line-height: 1.8;
            margin: 40px 0;
        }

        .completed-topics-section {
            margin: 50px 0;
            text-align: left;
        }

        .completed-topics-section h3 {
            color: #764ba2;
            margin-bottom: 30px;
            font-size: 1.8em;
            text-align: center;
        }

        .topics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .topic-badge {
            background: #f0f8ff;
            border-left: 5px solid #764ba2;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 1em;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .topic-badge strong {
            color: #764ba2;
            display: block;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .topic-badge small {
            color: #666;
            font-size: 0.9em;
        }

        .certificate-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 70px;
            padding-top: 40px;
            border-top: 2px solid gold;
        }

        .signature-box {
            text-align: center;
            width: 250px;
        }

        .signature-line {
            width: 100%;
            height: 2px;
            background: #333;
            margin: 15px 0;
        }

        .signature-title {
            color: #666;
            font-size: 1em;
        }

        .certificate-date {
            text-align: center;
            color: #666;
            margin-top: 40px;
            font-size: 1.1em;
        }

        .export-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            padding: 20px;
        }

        .export-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .export-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .home-btn {
            background: #764ba2;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 20px;
            font-weight: bold;
        }

        .no-completion {
            text-align: center;
            padding: 100px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .certificate {
                box-shadow: none;
            }
            .export-buttons, .home-btn {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .topics-grid {
                grid-template-columns: 1fr;
            }
            .certificate-name {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="certificateContainer">
        <!-- Content will be loaded dynamically -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Course structure (same as main page)
        const categories = {
            'Core Safety Units': [
                { id: 'core-1', title: 'Introduction to Industrial Safety', category: 'Core Safety Units' },
                { id: 'core-2', title: 'Hazard Identification & Risk Assessment', category: 'Core Safety Units' },
                { id: 'core-3', title: 'Personal Protective Equipment (PPE)', category: 'Core Safety Units' },
                { id: 'core-4', title: 'Emergency Response Procedures', category: 'Core Safety Units' },
                { id: 'core-5', title: 'Fire Safety & Prevention', category: 'Core Safety Units' },
                { id: 'core-6', title: 'Electrical Safety', category: 'Core Safety Units' },
                { id: 'core-7', title: 'Machine Guarding & Equipment Safety', category: 'Core Safety Units' },
                { id: 'core-8', title: 'Confined Space Entry', category: 'Core Safety Units' },
                { id: 'core-9', title: 'Chemical Handling & Storage', category: 'Core Safety Units' },
                { id: 'core-10', title: 'Workplace Ergonomics', category: 'Core Safety Units' }
            ],
            'Case Studies': [
                { id: 'case-1', title: 'Industrial Accident Investigation', category: 'Case Studies' },
                { id: 'case-2', title: 'Safety Culture Transformation', category: 'Case Studies' },
                { id: 'case-3', title: 'Emergency Response Success Story', category: 'Case Studies' },
                { id: 'case-4', title: 'Process Safety Management Implementation', category: 'Case Studies' },
                { id: 'case-5', title: 'Behavioral Safety Program Case', category: 'Case Studies' }
            ],
            'Specialized Industries': [
                { id: 'ccs', title: 'Carbon Capture & Storage Safety', category: 'Specialized Industries' },
                { id: 'nuclear', title: 'Nuclear Industry Safety', category: 'Specialized Industries' },
                { id: 'refinery', title: 'Petroleum Refinery Safety', category: 'Specialized Industries' },
                { id: 'food', title: 'Food Industry Safety', category: 'Specialized Industries' },
                { id: 'chemical', title: 'Chemical Manufacturing Safety', category: 'Specialized Industries' },
                { id: 'pharma', title: 'Pharmaceutical Safety', category: 'Specialized Industries' }
            ]
        };

        // Get completed topics
        function getCompletedTopics() {
            const completed = [];
            
            for (const category in categories) {
                categories[category].forEach(topic => {
                    const saved = localStorage.getItem(`progress_${topic.id}`);
                    if (saved === 'true') {
                        completed.push(topic);
                    }
                });
            }
            
            return completed;
        }

        // Check if all topics completed
        function allTopicsCompleted() {
            let total = 0;
            let completed = 0;
            
            for (const category in categories) {
                categories[category].forEach(topic => {
                    total++;
                    const saved = localStorage.getItem(`progress_${topic.id}`);
                    if (saved === 'true') {
                        completed++;
                    }
                });
            }
            
            return completed === total;
        }

        // Render certificate
        function renderCertificate() {
            const completedTopics = getCompletedTopics();
            const container = document.getElementById('certificateContainer');
            
            if (completedTopics.length === 0) {
                container.innerHTML = `
                    <div class="no-completion">
                        <h2 style="color: #764ba2; margin-bottom: 20px;">No Topics Completed</h2>
                        <p style="margin-bottom: 30px;">You haven't completed any topics yet. Complete at least one topic to generate a certificate.</p>
                        <a href="index.html" class="home-btn">‚Üê Back to Learning</a>
                    </div>
                `;
                return;
            }

            const isComplete = allTopicsCompleted();
            
            let topicsHtml = '';
            completedTopics.forEach(topic => {
                topicsHtml += `
                    <div class="topic-badge">
                        <strong>${topic.title}</strong>
                        <small>${topic.category}</small>
                    </div>
                `;
            });

            const certificateHtml = `
                <div class="certificate" id="certificate">
                    <div class="certificate-border">
                        <div class="certificate-header">
                            <div class="certificate-logo">üè≠</div>
                            <div class="certificate-title">Industrial Safety Institute</div>
                            <div class="certificate-subtitle">
                                ${isComplete ? 'Professional Certification' : 'Certificate of Completion'}
                            </div>
                        </div>

                        <div class="certificate-body">
                            <div class="certificate-label">This is to certify that</div>
                            <div class="certificate-name" id="userName">[Enter Your Name]</div>
                            <div class="certificate-text">
                                has successfully completed the following topics in the<br>
                                <strong>Industrial Safety Learning Program</strong>
                            </div>

                            <div class="completed-topics-section">
                                <h3>üìã Completed Topics (${completedTopics.length})</h3>
                                <div class="topics-grid">
                                    ${topicsHtml}
                                </div>
                            </div>

                            <div class="certificate-date" id="completionDate">
                                Completion Date: ${new Date().toLocaleDateString()}
                            </div>
                        </div>

                        <div class="certificate-footer">
                            <div class="signature-box">
                                <div class="signature-line"></div>
                                <div class="signature-title">Safety Director</div>
                            </div>
                            <div class="signature-box">
                                <div class="signature-line"></div>
                                <div class="signature-title">Training Coordinator</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="export-buttons">
                    <button class="export-btn" onclick="setNameAndExport()">‚úèÔ∏è Set Name & Export</button>
                    <button class="export-btn" onclick="exportAsPDF()">üì• Download as PDF</button>
                    <button class="export-btn" onclick="exportAsImage()">üñºÔ∏è Download as Image</button>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <a href="index.html" class="home-btn">‚Üê Back to Learning Portal</a>
                </div>
            `;

            container.innerHTML = certificateHtml;
        }

        // Set name and export
        function setNameAndExport() {
            const name = prompt('Please enter your name for the certificate:', 'John Doe');
            if (name) {
                document.getElementById('userName').textContent = name;
            }
        }

        // Export as PDF
        function exportAsPDF() {
            window.print();
        }

        // Export as Image
        function exportAsImage() {
            const certificate = document.getElementById('certificate');
            html2canvas(certificate, {
                scale: 2,
                logging: false,
                allowTaint: false,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'safety-certificate.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // Initialize
        renderCertificate();
    </script>
</body>
</html>
